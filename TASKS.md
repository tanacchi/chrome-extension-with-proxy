# テーブルデータAI分析ツール - 実装タスクリスト

## フェーズ1: 計画・設計

### 1.1 アーキテクチャ設計
- [x] 全体ディレクトリ構成の検討
- [x] 実装方針の決定（TDD、小さなステップでの実装）
- [x] 技術スタック詳細の確認（AI SDK、OpenAI統合方法）
- [x] データフロー設計（テーブル→抽出→API→表示）
- [x] 設計書レビュー依頼・承認

### 1.2 開発環境準備
- [x] 依存関係の追加検討（@ai-sdk/react, @ai-sdk/openai等）
- [x] package.jsonの更新方針決定
- [x] 開発・テスト用サーバー構成の設計
- [x] 環境構築手順の整理

## フェーズ2: 開発・テスト用インフラ整備

### 2.1 サンプルHTMLサーバー
- [x] サンプルHTMLサーバーのテスト作成
- [x] サンプルHTMLサーバーの実装
- [x] 3x3テーブルのHTMLテンプレート作成
- [x] 適切なクラス名設定の確認
- [x] サンプルHTMLサーバーの動作テスト

### 2.2 モックAPIサーバー
- [x] モックAPIサーバーのテスト作成
- [x] OpenAI API準拠のレスポンス形式調査
- [x] モックAPIサーバーの実装
- [x] 入力30文字利用の簡易レスポンス実装
- [x] モックAPIサーバーの動作テスト

## フェーズ3: 設定管理機能

### 3.1 ストレージ定義
- [x] AISettings型定義のテスト作成
- [x] AISettings型定義の実装
- [x] AnalysisResult型定義のテスト作成
- [x] AnalysisResult型定義の実装
- [x] ストレージヘルパー関数のテスト作成
- [x] ストレージヘルパー関数の実装
- [x] ストレージ機能の動作テスト

### 3.2 設定画面（Options）
- [x] 設定画面UIコンポーネントのテスト作成
- [x] 設定画面レイアウトの実装
- [x] モデル選択機能のテスト作成
- [x] モデル選択機能の実装
- [x] APIキー設定機能のテスト作成
- [x] APIキー設定機能の実装
- [x] カスタムプロンプト設定機能のテスト作成
- [x] カスタムプロンプト設定機能の実装
- [x] デフォルトプロンプト表示機能のテスト作成
- [x] デフォルトプロンプト表示機能の実装
- [x] 設定保存・読み込み機能のテスト作成
- [x] 設定保存・読み込み機能の実装
- [x] 設定画面全体の動作テスト

## フェーズ4: テーブル検出・データ抽出機能

### 4.1 テーブル検出機能
- [x] テーブル検出ロジックのテスト作成
- [x] クラス名`ai-target-table-table`の検出実装
- [x] 最初のテーブル選択ロジックの実装
- [x] tbodyの検出実装
- [x] テーブル検出機能の動作テスト

### 4.2 データ抽出機能
- [x] データ抽出ロジックのテスト作成
- [x] tr要素の取得実装
- [x] 2列目td要素の取得実装
- [x] 空行除外ロジックの実装
- [x] データ抽出機能の動作テスト

### 4.3 Content Script統合
- [x] Content Scriptエントリーポイントのテスト作成
- [x] Content Scriptエントリーポイントの実装
- [x] テーブル検出とデータ抽出の統合テスト作成
- [x] テーブル検出とデータ抽出の統合実装
- [x] Content Script全体の動作テスト

## フェーズ5: UI注入機能

### 5.1 分析ボタン注入
- [x] ボタン注入ロジックのテスト作成
- [x] ボタンUIコンポーネントの実装
- [x] テーブル左側への配置ロジックの実装
- [x] ボタンクリックイベントの実装
- [x] ボタン注入機能の動作テスト

### 5.2 吹き出し表示機能
- [x] 吹き出しUIコンポーネントのテスト作成
- [x] 吹き出しUIコンポーネントの実装
- [x] セル右側への配置ロジックの実装
- [x] 複数吹き出しの管理機能の実装
- [x] 吹き出し表示機能の動作テスト

### 5.3 ローディング表示
- [x] ローディングUIコンポーネントのテスト作成
- [x] ローディングUIコンポーネントの実装
- [x] ローディング状態管理の実装
- [x] ローディング表示機能の動作テスト

## フェーズ6: AI API統合機能

### 6.1 @ai-sdk/react統合
- [x] @ai-sdk/reactパッケージの統合
- [x] AI APIクライアントのテスト作成（11テスト）
- [x] AI SDK統合実装（useChat活用）
- [x] APIキー管理機能の実装
- [x] モデル選択機能の実装
- [x] エラーハンドリングの実装
- [x] APIクライアントの動作テスト

### 6.2 プロンプト生成機能
- [x] システムプロンプト生成のテスト作成
- [x] システムプロンプト生成の実装
- [x] ユーザープロンプト統合の実装
- [x] テーブルデータ埋め込みの実装
- [x] SPECIFICATION.md準拠プロンプト実装
- [x] プロンプト生成機能の動作テスト

### 6.3 Background Script統合
- [x] Background ScriptのAPI通信機能のテスト作成（11テスト）
- [x] Background ScriptのAPI通信機能の実装
- [x] Content ScriptとBackground Script間通信のテスト作成
- [x] Content ScriptとBackground Script間通信の実装
- [x] Chrome messagingによる安全な通信実装
- [x] Background Script全体の動作テスト

### 6.4 Content Script AI統合
- [x] Content Script AI分析機能のテスト作成（13テスト）
- [x] AI分析機能の実装
- [x] プログレス表示機能の実装
- [x] 結果表示ダイアログの実装
- [x] エラーハンドリングとユーザーフィードバック
- [x] Content Script AI統合の動作テスト

### 6.5 JSDoc・品質保証・E2E
- [ ] JSDocコメントの充実（TypeScript開発者向け）
- [ ] ユニットテスト拡充（追加エッジケース）
- [ ] E2Eテストスイート実装
- [ ] ドキュメントカバレッジ測定
- [ ] パフォーマンステスト

## フェーズ7: ポップアップ機能

### 7.1 ポップアップUI
- [ ] ポップアップUIコンポーネントのテスト作成
- [ ] ポップアップレイアウトの実装
- [ ] テーブル検出状況表示のテスト作成
- [ ] テーブル検出状況表示の実装
- [ ] 分析実行ボタンのテスト作成
- [ ] 分析実行ボタンの実装
- [ ] 設定画面遷移ボタンのテスト作成
- [ ] 設定画面遷移ボタンの実装
- [ ] ポップアップ全体の動作テスト

### 7.2 ポップアップからの分析実行
- [ ] ポップアップ経由分析実行のテスト作成
- [ ] アクティブタブとの通信実装
- [ ] 分析結果フィードバックの実装
- [ ] ポップアップ分析実行機能の動作テスト

## フェーズ8: Storybook 導入
- [ ] Storybook 導入/ package.json のスクリプト追加
- [ ] Storybook の方で UI テストを拡充

## フェーズ9: 統合機能・エンドツーエンド

### 9.1 全機能統合
- [ ] 全機能統合テストの作成
- [ ] テーブル検出→データ抽出→API呼び出し→結果表示の統合テスト
- [ ] 設定変更→分析実行の統合テスト
- [ ] エラーケースの統合テスト
- [ ] パフォーマンステスト

### 9.2 マニフェスト更新
- [ ] manifest.tsの権限更新
- [ ] Content Scriptsの登録更新
- [ ] host_permissionsの更新
- [ ] マニフェスト設定の動作確認

### 9.3 E2Eテスト
- [ ] E2Eテストシナリオの作成
- [ ] サンプルHTMLでのE2Eテスト実装
- [ ] 設定画面のE2Eテスト実装
- [ ] 分析機能のE2Eテスト実装
- [ ] エラーケースのE2Eテスト実装

## フェーズ10: 品質保証・仕上げ

### 10.1 品質チェック
- [ ] TypeScript型チェック
- [ ] ESLintによるコード品質チェック
- [ ] Prettierによるフォーマット確認
- [ ] テストカバレッジ確認
- [ ] パフォーマンス測定

### 10.2 ドキュメント更新
- [ ] README.mdの更新（新機能反映）
- [ ] SPECIFICATION.mdの実装結果反映
- [ ] CLAUDE.mdの更新（必要に応じて）
- [ ] コード内コメントの充実

### 10.3 最終動作確認
- [ ] 全機能の総合動作テスト
- [ ] 異なるWebサイトでの動作確認
- [ ] エラーハンドリングの確認
- [ ] ユーザビリティ確認
- [ ] セキュリティチェック

---

## 注意事項

- 各タスク完了時は必ずチェックボックスにチェックを入れること
- テスト実装 → 実装 → テスト実行の順序を守ること
- 不具合発見時は即座に修正し、関連テストを追加すること
- 各フェーズ完了時に全体動作確認を実施すること
- 仕様変更が発生した場合はSPECIFICATION.mdを更新すること
